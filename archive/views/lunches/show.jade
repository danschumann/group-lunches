extends ../layout

block head
  -var title = restaurant.attributes.name

block content 
  h1.lunch_title= attributes.name
  h3 We're eating at #{restaurant.attributes.name}
  - if (restaurant.attributes.url)
    span (
    a(href="#{restaurant.attributes.url}" target="_blank" title='View menu') menu
    span )

  hr

  - if ((orders || {}).length)
    table.display-table
      thead
        th Order for
        th Order
        - if (owner)
          th Amount Paid
        th Price
        th
        th
      -for (var i = 0; i < orders.length; i++)
        - var order = orders[i]
        tr
          td= order.user
          td= order.description
          - if (owner)
            td
              input.order_paid(value="#{order.paid || ''}", data-order_id="#{order.id}", data-lunch_id="#{attributes.id}")
              script(src="/javascripts/order_paid.js")
          td= order.price
          td(class='option-column')
            - if (!attributes.locked)
               a(href="/lunches/#{attributes.id}/orders/#{order.id}") Edit
          td(class='option-column') 
            - if (!attributes.locked)
               a(href="/lunches/#{attributes.id}/orders/#{order.id}/delete") Delete
  - else
    div.empty_section There are currently no orders.

    
  - if (attributes.locked)
    .description.no_more NO MORE ORDERS!  WE GONNA PICK IT UP NOW! KTHXBYEYW
  -else
    p
      a(href="/lunches/#{attributes.id}/orders/new", class='button') New order

  - if (owner)

    hr
    div.copythis_section
      span Feed people this url
      input.copythis(value="#{full_url}")
      script(src="/javascripts/copythis.js")
    hr
    if (!attributes.locked)
      form(action="/lunches/#{id}", method="post")
        input(type="hidden", value="true", name="locked")
        input(type="submit", onclick="return confirm('This will stop anyone from ordering or editting')", value="No more orders, please!")
